---
title: Installing and Upgrading Redis for PCF
owner: London Services
---

<a id="install"></a>
## Installation Steps

To add Redis for PCF to Ops Manager, follow the procedure for adding Pivotal Ops Manager tiles:

1. Download the product file from [Pivotal Network](https://network.pivotal.io/products/p-redis).
1. Upload the product file to your Ops Manager installation.
1. Click **Add** next to the uploaded product description in the Available Products view to add this product to your staging area.
1. (Optional) Click the newly added tile to configure your [possible service plans](#configure) and [syslog draining](#syslog).
1. Click **Apply Changes** to install the service.


## Configuring Redis Service Plans
 
Select the **Redis** tile from the Installation Dashboard to display the configuration page and configure the Redis service plans.

### Assigning AZ's and Networks

Assigning multiple AZs to Redis jobs will not guarantee high availability.

All of your Shared-VM instances will run on a single node in just one of the configured availability zones and are therefore not highly availabile.

Each Dedicated-VM instance could be assigned to any of the configured availability zones, however each instance still operates as a single node with no clustering. This separation over availability zones provides no high availability.

![Shared-VM Diagram](AZ-assignment.png)

### Shared-VM Plan 

1.  Select the **Shared-VM Plan** tab to configure the memory limit for each Redis instance and the maximum number of instances that can be created.

1.  Enter the maximum number of instances and the memory limit for each Redis instance.

1.  Click the **Save** button.

    <br />Shared-VM instances run on the Redis Broker.

    <br />The memory and instance limits for your Shared-VM Redis instances should depend on the total memory of your Redis broker.
    When configuring the maximum number of Redis service instances that can be created you need to take into account the maximum memory each redis instance could use in correlation with how much total memory the Redis broker has.
    We recommend you only allow up to 45% of your Redis broker's total memory to be used by all Redis instances.
    This is due the amount of memory required to support Redis persistence, and run Redis broker & system tasks.

    <br />See below for example cases:

    <table border="1" class="nice">
    	<tr>
    		<th>Redis Broker Total Memory</th>
    		<th>Redis Instance Memory Limit</th>
    		<th>Redis Service Instance Limit</th>
    	</tr>
    	<tr>
    	 	<td>16GB</td>
    	 	<td>512MB</td>
    	 	<td>14</td>
     	</tr>
      <tr>
    	 	<td>16GB</td>
    	 	<td>256MB</td>
    	 	<td>28</td>
     	</tr>
      <tr>
    	 	<td>64GB</td>
    	 	<td>512MB</td>
    	 	<td>56</td>
     	</tr>
    </table>


    <br />It is possible to configure a larger Redis Service Instance Limit, if you are confident that the majority of the deployed instances will not be using a large amount of their allocated memory, for example in development or test environments.
    <p class="note"><strong>Note</strong>:
      This is not supported, and could cause your server to run out of memory.
      If this happens your users may not be able to write any further data to any Redis instance.
    </p>


1.  Select the **Resource Config** tab to change the allocation of resources for the Redis Broker.
    <br />The Redis Broker server will run all of the Redis instances for your Shared-VM plan. From this screen you may increase or decrease the CPU, RAM, Ephemeral Disk & Persistent Disk made available, as required.

1.  Click the **Save** button.

### Dedicated-VM Plan - Resource Allocation

1.  Select the **Resource Config** tab to change the allocation of resources for the Dedicated Node.

    <br />By default, 5 dedicated nodes will be created, each capable of running one Redis instance. You can increase or decrease the number of dedicated nodes, the size of the Persistent and Ephemeral Disks, and the CPU and RAM, as required.
The default VM size is small; it is important that the operator set the correct VM size to handle anticipated loads. The maxmemory value for the Redis process is set to be 45% of the RAM for that instance.

1.  Click the **Save** button.


<a id="syslog"></a>
## Configuring Syslog Output

Pivotal recommends that operators configure a syslog output.

1. Select the **Syslog** tab to setup the details of your syslog draining.
1.  Add the Syslog address and Syslog port of your log management tool.

    The information required for these fields will be provided by your log management tool.

<a id="azs"></a>
## Assigning AZ's and Networks

Assigning multiple AZs to Redis jobs will not guarantee high availability.

All of your Shared-VM instances will run on a single node in just one of the configured availability zones and are therefore not highly availabile.

Each Dedicated-VM instance could be assigned to any of the configured availability zones, however each instance still operates as a single node with no clustering. This separation over availability zones provides no high availability.

![AZ Assignment Diagram](AZ-assignment.png)

<a id="upgrades"></a>
## Upgrading Redis for PCF

This product enables a seamless upgrade experience between versions of the product that is deployed through Ops Manager.

The upgrade paths are detailed [here](http://docs.pivotal.io/redis/1-6/index.html) for each released version.

To upgrade the product:

* The Operator should download the latest version of the product from [Pivotal Network](https://network.pivotal.io/products/p-redis)
* Upload the new .pivotal file to Ops Manager
* Upload the stemcell associated with the update (*if required*)
* Update any new mandatory configuration parameters (*if required*)
* Press "Apply changes" and the rest of the process is automated

During the upgrade deployment each Redis instance will experience a small period of downtime as each Redis instance is updated with the new software components. This downtime is because the Redis instances are single VMs operating in a non HA setup. The length of the downtime depends on whether there is a stemcell update to replace the operating system image or whether the existing VM can simply have the redis software updated. Stemcells updates incur additional downtime while the IaaS creates the new VM while updates without a stemcell update are faster.

Ops Manager ensures the instances are updated with the new packages and any configuration changes are applied automatically.

Upgrading to a newer version of the product does not cause any loss of data or configuration. This is explicitly tested for during our build and test process for a new release of the product.

# Release policy

When a new version of Redis is released we aim to release a new version of the product containing this soon after.

Where there is a new version of Redis or another dependent software component such as the stemcell released due to a critical CVE, Pivotal's goal is to release a new version of the product within 48 hours. 
## Installation Steps
